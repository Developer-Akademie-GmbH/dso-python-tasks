# KeePass Master Password Cracker

## Overview

This Python script is an exploit designed to automate the process of exploiting the security vulnerability `CVE-2023-32784`. The script aims to crack the master passwords of KeePass databases (`.kdbx` files) using partial password dumps from `.DMP` files. It attempts to find the correct password by iterating through a charset for the first character of the password and appending it to the rest of the password parts obtained from the `.DMP` file. Successful password discoveries are recorded in a `.potfile`.

## Features

- Reads `.kdbx` and `.DMP` files from a specified directory.
- Iterates through possible passwords by substituting the first character with every character in a predefined charset.
- Attempts to log into each `.kdbx` file using the generated passwords.
- Records successfully cracked passwords in a `.potfile`.

## Requirements

- Python 3.12
- pykeepass 4.0.7
- Access to a directory containing .kdbx and .DMP files
- A working environment for running .NET or other password extraction tools

## Installation

1. Clone the Repository:

    ```bash
    git clone https://github.com/JohnTwiiX/dso-python-tasks.git
    cd exploit
    ```

2. Install Dependencies:

    Ensure you have pykeepass installed. You can install it via pip:

    ```bash
    pip install pykeepass
    ```

3. Prepare the Dump Tool:

    This script assumes a tool located in ./keepass-dump-masterkey.

    ```bash
    git clone https://github.com/matro7sh/keepass-dump-masterkey.git
    ```

## Usage

1. Place Your Files:

    - Ensure your .kdbx and .DMP files are in a directory, e.g., ./data.

2. Run the Script:

    ```bash
    python3 exploit.py -dir ./data
    ```

    Replace ./data with the path to your directory containing the files.

3. Review the Results:

    The successfully cracked passwords will be saved in a `.potfile` in the specified directory.

## Code Explanation

### Main Functions

#### `read_dump_file(file_name, dmp_file, keepass_dump_dir)`

Reads the password parts from the `.DMP` file by running a script (e.g., `poc.py`).

#### `generate_passwords(start_char, password_parts)`

Generates possible passwords by appending a start character to the password parts.

#### `try_login(kdbx_file, password)`

Attempts to log into the `.kdbx` file using the generated password.

#### `main(dir_path)`

Main function that coordinates the reading of `.kdbx` and `.DMP` files, generating passwords, and attempting to log in.

### Charset for Passwords

The `charset_first_char` variable defines the characters used to replace the first character of each password part:

```python
charset_first_char = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+-=[]{}|;:',.<>?`~"
```

## Troubleshooting

- Error: `Dictionary not found!`

  - Ensure that the specified directory contains `.kdbx` and `.DMP` files.

- Error: `Keepass Password Dumper program closed.`

  - Ensure that the password dumper script or tool is working correctly and accessible in the specified directory.

## Security Disclaimer

This tool is intended for educational purposes and for testing the security of systems where you have explicit permission to do so. Unauthorized use of this tool against systems where you do not have permission may violate laws and regulations.
